<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trouver un Prof | Examen Mada</title>
    
    <!-- Fonts & Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Cinzel:wght@700&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           VARIABLES (Identiques)
           ========================================= */
        :root {
            --nav-height: 70px;
            --gold: #d4af37;
            --gold-glow: rgba(212, 175, 55, 0.4);
            --tech-blue: #0ea5e9;
            --success: #10b981;
        }

        :root[data-theme="dark"] {
            --bg-body: #0f172a;
            --bg-panel: #1e293b;
            --bg-input: #020617;
            --border: rgba(255,255,255,0.1);
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --shadow: rgba(0,0,0,0.6);
        }

        :root[data-theme="light"] {
            --bg-body: #f8fafc;
            --bg-panel: #ffffff;
            --bg-input: #e2e8f0;
            --border: #cbd5e1;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --shadow: rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            padding-top: var(--nav-height);
            transition: background 0.3s, color 0.3s;
        }

        /* HEADER */
        header {
            position: fixed; top: 0; width: 100%; height: var(--nav-height);
            background: var(--bg-panel); border-bottom: 2px solid var(--gold);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 5%; z-index: 1000; box-shadow: 0 5px 20px var(--shadow);
        }
        .logo h1 { font-family: 'Cinzel', serif; font-size: 1.3rem; margin: 0; }
        .logo span { color: var(--gold); }
        .logo a { text-decoration: none; color: var(--text-main); }

        .header-controls { display: flex; gap: 10px; align-items: center; }
        
        /* Language Selector Style */
        .lang-select {
            background: var(--bg-input); color: var(--text-main);
            border: 1px solid var(--border); padding: 5px 10px;
            border-radius: 20px; font-family: 'Rajdhani'; font-weight: bold;
            cursor: pointer; outline: none;
        }
        .lang-select:focus { border-color: var(--gold); }

        .theme-btn, .home-btn {
            background: transparent; border: 1px solid var(--border); color: var(--text-main);
            width: 40px; height: 40px; border-radius: 50%; cursor: pointer; transition: 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .home-btn:hover { border-color: var(--gold); color: var(--gold); }

        /* HERO */
        .page-header {
            height: 35vh;
            background: linear-gradient(to bottom, rgba(15,23,42,0.9), var(--bg-body)), url('https://images.unsplash.com/photo-1503676260728-1c00da094a0b?q=80&w=1920&auto=format&fit=crop');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 0 20px;
        }
        .page-header h2 { font-family: 'Cinzel', serif; font-size: 2.2rem; color: #fff; margin-bottom: 10px; text-shadow: 0 5px 15px #000; }
        .page-header p { color: var(--gold); font-size: 1.1rem; letter-spacing: 1px; }

        /* FILTERS */
        .filter-container {
            max-width: 1200px; margin: -30px auto 40px; padding: 20px;
            background: var(--bg-panel); border: 1px solid var(--border);
            border-radius: 12px; box-shadow: 0 10px 30px var(--shadow);
            display: flex; flex-wrap: wrap; gap: 15px;
            position: relative; z-index: 10;
        }
        .filter-group { flex: 1; min-width: 200px; }
        .filter-group label { display: block; margin-bottom: 5px; color: var(--gold); font-size: 0.9rem; font-weight: bold; }
        .custom-select {
            width: 100%; padding: 12px; border-radius: 6px;
            background: var(--bg-input); border: 1px solid var(--border);
            color: var(--text-main); font-family: 'Rajdhani'; font-size: 1rem;
            cursor: pointer; outline: none;
        }

        /* GRID */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px 60px; }
        .courses-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }

        .course-card {
            background: var(--bg-panel); border: 1px solid var(--border);
            border-radius: 12px; overflow: hidden; transition: 0.3s;
            display: flex; flex-direction: column; position: relative;
        }
        .course-card:hover { transform: translateY(-5px); border-color: var(--gold); box-shadow: 0 10px 25px var(--shadow); }

        .card-header { height: 140px; position: relative; background: var(--bg-input); }
        .card-bg-img { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; }
        .level-badge {
            position: absolute; top: 10px; right: 10px; padding: 5px 12px;
            border-radius: 4px; font-weight: bold; font-size: 0.85rem; color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .lvl-cepe { background: var(--success); }
        .lvl-bepc { background: var(--tech-blue); }
        .lvl-bac { background: var(--gold); color: #000; }

        .prof-avatar {
            width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--bg-panel);
            position: absolute; bottom: -40px; left: 20px; object-fit: cover; background: #000;
        }

        .card-body { padding: 45px 20px 20px; flex-grow: 1; }
        .prof-name { font-family: 'Cinzel'; font-size: 1.1rem; color: var(--text-main); margin-bottom: 5px; }
        .subject-title { color: var(--gold); font-weight: bold; margin-bottom: 10px; display: block; font-size: 0.95rem; text-transform: uppercase; }
        
        .card-details { list-style: none; margin-bottom: 20px; }
        .card-details li { display: flex; align-items: center; gap: 10px; color: var(--text-muted); font-size: 0.9rem; margin-bottom: 8px; }
        .card-details i { width: 20px; text-align: center; color: var(--tech-blue); }

        .location-tag {
            display: inline-block; background: rgba(255,255,255,0.05); padding: 2px 8px;
            border-radius: 4px; font-size: 0.8rem; border: 1px solid var(--border); margin-left: auto;
        }

        .card-footer {
            padding: 15px 20px; border-top: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.2);
        }
        .price { font-weight: bold; color: var(--text-main); font-size: 1.1rem; }
        
        .contact-btn {
            background: var(--gold); color: #000; border: none; padding: 8px 15px;
            border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.3s;
            text-decoration: none; display: inline-flex; align-items: center; gap: 5px;
        }
        .contact-btn:hover { background: #fff; }

        .loader { text-align: center; padding: 40px; display: none; width: 100%; grid-column: 1 / -1; }
        .no-results { text-align: center; width: 100%; padding: 40px; color: var(--text-muted); grid-column: 1 / -1; display: none; }

        footer { background: var(--bg-input); border-top: 1px solid var(--gold); padding: 40px 5%; text-align: center; margin-top: auto; }
    </style>
</head>
<body>

    <!-- HEADER -->
    <header>
        <div class="logo">
            <a href="index.html">
                <h1><i class="fas fa-chalkboard-teacher"></i> EXAMEN <span>MADA</span></h1>
            </a>
        </div>
        
        <div class="header-controls">
            <!-- SÃ©lecteur de Langue -->
            <select id="langSelector" class="lang-select" onchange="changeLanguage(this.value)">
                <option value="fr">ðŸ‡«ðŸ‡· FR</option>
                <option value="mg">ðŸ‡²ðŸ‡¬ MG</option>
                <option value="en">ðŸ‡¬ðŸ‡§ EN</option>
            </select>

            <button class="home-btn" onclick="window.location.href='index.html'">
                <i class="fas fa-home"></i>
            </button>
            <button class="theme-btn" onclick="toggleTheme()">
                <i class="fas fa-moon" id="themeIcon"></i>
            </button>
        </div>
    </header>

    <!-- HERO -->
    <section class="page-header">
        <h2 data-i18n="hero_title">TROUVER UN PROFESSEUR</h2>
        <p data-i18n="hero_desc">Cours particuliers, soutien scolaire et prÃ©paration intensive.</p>
    </section>

    <!-- FILTRES -->
    <div class="filter-container">
        <div class="filter-group">
            <label data-i18n="label_level"><i class="fas fa-graduation-cap"></i> Niveau</label>
            <select id="filterLevel" class="custom-select" onchange="filterCourses()">
                <option value="all" data-i18n="opt_all_levels">Tous les niveaux</option>
                <option value="CEPE">CEPE (CM2)</option>
                <option value="BEPC">BEPC (3Ã¨me)</option>
                <option value="BAC">BAC (Terminale)</option>
            </select>
        </div>

        <div class="filter-group">
            <label data-i18n="label_province"><i class="fas fa-map-marker-alt"></i> Province / Lieu</label>
            <select id="filterProvince" class="custom-select" onchange="filterCourses()">
                <option value="all" data-i18n="opt_all_loc">Toute l'Ã®le</option>
                <option value="Antananarivo">Antananarivo</option>
                <option value="Toamasina">Toamasina</option>
                <option value="Fianarantsoa">Fianarantsoa</option>
                <option value="Mahajanga">Mahajanga</option>
                <option value="Toliara">Toliara</option>
                <option value="Antsiranana">Antsiranana</option>
            </select>
        </div>

        <div class="filter-group">
            <label data-i18n="label_mode"><i class="fas fa-wifi"></i> Mode d'enseignement</label>
            <select id="filterMode" class="custom-select" onchange="filterCourses()">
                <option value="all" data-i18n="opt_all_modes">Tous</option>
                <option value="online" data-i18n="opt_online">En Ligne</option>
                <option value="salle" data-i18n="opt_salle">En Salle</option>
                <option value="domicile" data-i18n="opt_domicile">Ã€ Domicile</option>
            </select>
        </div>
    </div>

    <!-- GRILLE CONTENU -->
    <div class="container">
        <div class="loader" id="loader">
            <i class="fas fa-circle-notch fa-spin fa-2x" style="color:var(--gold)"></i> 
            <span data-i18n="loading">Chargement...</span>
        </div>
        
        <div class="courses-grid" id="coursesGrid">
            <!-- InjectÃ© par JS -->
        </div>
        
        <div class="no-results" id="noResults">
            <h3 data-i18n="no_result_title"><i class="far fa-frown"></i> Aucun rÃ©sultat trouvÃ©</h3>
            <p data-i18n="no_result_desc">Essayez de modifier vos filtres.</p>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <p>&copy; 2026 EXAMEN MADA. <span data-i18n="footer_text">Plateforme Ã©ducative nationale.</span></p>
    </footer>

    <script>
        /* =========================================
           1. DICTIONNAIRE DE TRADUCTION
           ========================================= */
        const translations = {
            fr: {
                hero_title: "TROUVER UN PROFESSEUR",
                hero_desc: "Cours particuliers, soutien scolaire et prÃ©paration intensive (CM2, 3Ã¨me, BAC).",
                label_level: "Niveau",
                label_province: "Province / Lieu",
                label_mode: "Mode d'enseignement",
                opt_all_levels: "Tous les niveaux",
                opt_all_loc: "Toute l'Ã®le",
                opt_all_modes: "Tous",
                opt_online: "En Ligne",
                opt_salle: "En Salle",
                opt_domicile: "Ã€ Domicile",
                loading: "Chargement des cours...",
                no_result_title: "Aucun rÃ©sultat trouvÃ©",
                no_result_desc: "Essayez de modifier vos filtres.",
                footer_text: "Plateforme Ã©ducative nationale.",
                
                // Textes dynamiques pour les cartes
                card_online: "En Ligne",
                card_salle: "En Salle / PrÃ©sentiel",
                card_domicile: "Ã€ Domicile",
                btn_contact: "Contacter",
                msg_whatsapp: "Bonjour, je suis intÃ©ressÃ© par vos cours de"
            },
            mg: {
                hero_title: "HITADY MPAMPIANATRA",
                hero_desc: "Fampianarana manokana, fanamafisana fahaizana ho an'ny fanadinana.",
                label_level: "Ambaratonga",
                label_province: "Faritany / Toerana",
                label_mode: "Fomba fampianarana",
                opt_all_levels: "Ambaratonga rehetra",
                opt_all_loc: "Manerana ny nosy",
                opt_all_modes: "Rehetra",
                opt_online: "An-tserasera (Online)",
                opt_salle: "An-dakilasy",
                opt_domicile: "Any an-tokantrano",
                loading: "Maka ny lisitra...",
                no_result_title: "Tsy misy hita",
                no_result_desc: "Andramo ovaina ny sivana (filtre).",
                footer_text: "Sehatra fanabeazana nasionaly.",

                // Textes dynamiques pour les cartes
                card_online: "An-tserasera",
                card_salle: "An-dakilasy / Salle",
                card_domicile: "Any an-tokantrano",
                btn_contact: "Hifandray",
                msg_whatsapp: "Miarahaba, liana amin'ny fampianarana taranja"
            },
            en: {
                hero_title: "FIND A TEACHER",
                hero_desc: "Private tutoring, academic support and intensive preparation.",
                label_level: "Level",
                label_province: "Province / Location",
                label_mode: "Teaching Mode",
                opt_all_levels: "All levels",
                opt_all_loc: "All locations",
                opt_all_modes: "All",
                opt_online: "Online",
                opt_salle: "In Class",
                opt_domicile: "At Home",
                loading: "Loading courses...",
                no_result_title: "No results found",
                no_result_desc: "Try changing your filters.",
                footer_text: "National educational platform.",

                // Textes dynamiques pour les cartes
                card_online: "Online",
                card_salle: "In Classroom",
                card_domicile: "At Home",
                btn_contact: "Contact",
                msg_whatsapp: "Hello, I am interested in your course for"
            }
        };

        // Variable globale langue
        let currentLang = 'fr'; 

        /* =========================================
           2. CONFIGURATION & DONNÃ‰ES
           ========================================= */
        const API_URL = "https://696d45f4f4a79b315180e444.mockapi.io/V1/mpampianatra";
        
        const FALLBACK_DATA = [
            { id: 1,
                name: "Mme. Rasoa",
                subject: "FranÃ§ais & Malagasy",
                level: "CEPE",
                mode: "salle",
                province: "Antananarivo",
                location: "67Ha Centre",
                price: "20 000",
                image: "https://images.unsplash.com/photo-1544717305-2782549b5136?q=80&w=200&auto=format&fit=crop",
                phone: "0341234567"
            },
            {
                id: 2,
                name: "Mr. Andriatsitohaina",
                subject: "MathÃ©matiques & Physique",
                level: "BAC",
                mode: "online",
                province: "Antananarivo", // MÃªme si online, on met une base
                location: "Via Google Meet / Zoom",
                price: "50 000",
                image: "https://images.unsplash.com/photo-1568602471122-7832951cc4c5?q=80&w=200&auto=format&fit=crop",
                phone: "0321122334"
            },
            {
                id: 3,
                name: "Groupe EXCELLENCE",
                subject: "PrÃ©paration BEPC (Toutes matiÃ¨res)",
                level: "BEPC",
                mode: "salle",
                province: "Toamasina",
                location: "LycÃ©e Stella Maris",
                price: "30 000",
                image: "https://images.unsplash.com/photo-1524178232363-1fb2b075b655?q=80&w=200&auto=format&fit=crop",
                phone: "0334455667"
            },
            {
                id: 4,
                name: "Prof. Solo",
                subject: "Philosophie",
                level: "BAC",
                mode: "domicile",
                province: "Fianarantsoa",
                location: "DÃ©placement en ville",
                price: "10 000 / h",
                image: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?q=80&w=200&auto=format&fit=crop",
                phone: "0389988776"
            }
        ];

        let allCourses = [];

        /* =========================================
           3. INIT & LANGUE
           ========================================= */
        
        async function init() {
            initTheme();
            
            // Charger la langue sauvegardÃ©e ou defaut FR
            const savedLang = localStorage.getItem('lang') || 'fr';
            document.getElementById('langSelector').value = savedLang;
            changeLanguage(savedLang);

            await fetchCourses();
        }

        // Fonction de changement de langue
        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            
            // 1. Traduire les textes statiques (data-i18n)
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(translations[lang][key]) {
                    el.innerText = translations[lang][key];
                }
            });

            // 2. Re-gÃ©nÃ©rer les cartes pour traduire les boutons et labels
            if(allCourses.length > 0) {
                filterCourses();
            }
        }

        /* =========================================
           4. CHARGEMENT & AFFICHAGE
           ========================================= */
        async function fetchCourses() {
            const loader = document.getElementById('loader');
            loader.style.display = 'block';
            
            try {
                const res = await fetch(API_URL);
                if (!res.ok) throw new Error("API Error");
                const data = await res.json();
                allCourses = data.length > 0 ? data : FALLBACK_DATA;
            } catch (error) {
                console.warn("Utilisation donnÃ©es secours");
                allCourses = FALLBACK_DATA;
            } finally {
                loader.style.display = 'none';
                filterCourses();
            }
        }

        function filterCourses() {
            const fLevel = document.getElementById('filterLevel').value;
            const fProvince = document.getElementById('filterProvince').value;
            const fMode = document.getElementById('filterMode').value;
            const grid = document.getElementById('coursesGrid');
            const noRes = document.getElementById('noResults');

            grid.innerHTML = '';

            const filtered = allCourses.filter(c => {
                const matchLevel = fLevel === 'all' || c.level === fLevel;
                const matchProvince = fProvince === 'all' || c.province === fProvince;
                const matchMode = fMode === 'all' || c.mode === fMode;
                return matchLevel && matchProvince && matchMode;
            });

            if (filtered.length === 0) {
                noRes.style.display = 'block';
                return;
            } else {
                noRes.style.display = 'none';
            }

            // RÃ©cupÃ©rer les textes traduits pour les cartes
            const t = translations[currentLang];

            filtered.forEach(course => {
                // Style Badge
                let badgeClass = 'lvl-bac';
                if(course.level === 'CEPE') badgeClass = 'lvl-cepe';
                if(course.level === 'BEPC') badgeClass = 'lvl-bepc';

                // Mode & Texte Traduit
                let modeIcon = 'fa-chalkboard-teacher';
                let modeText = t.card_salle; // Default traduit
                
                if(course.mode === 'online') { 
                    modeIcon = 'fa-laptop'; 
                    modeText = t.card_online; 
                }
                if(course.mode === 'domicile') { 
                    modeIcon = 'fa-home'; 
                    modeText = t.card_domicile; 
                }

                // URL Whatsapp avec message traduit
                const waMsg = `${t.msg_whatsapp} ${course.subject} (${course.level})`;
                const waLink = `https://wa.me/261${course.phone.substring(1)}?text=${encodeURIComponent(waMsg)}`;

                const card = document.createElement('div');
                card.className = 'course-card';
                card.innerHTML = `
                    <div class="card-header">
                        <img src="${getCoverImage(course.subject)}" class="card-bg-img" alt="Cover">
                        <span class="level-badge ${badgeClass}">${course.level}</span>
                        <img src="${course.image}" alt="${course.name}" class="prof-avatar">
                    </div>
                    <div class="card-body">
                        <h4 class="prof-name">${course.name}</h4>
                        <span class="subject-title">${course.subject}</span>
                        
                        <ul class="card-details">
                            <li><i class="fas ${modeIcon}"></i> ${modeText}</li>
                            <li>
                                <i class="fas fa-map-marker-alt"></i> 
                                ${course.province} 
                                ${course.mode !== 'online' ? `<span class="location-tag">${course.location}</span>` : ''}
                            </li>
                        </ul>
                    </div>
                    <div class="card-footer">
                        <div class="price">${course.price} <span style="font-size:0.8rem">Ar</span></div>
                        <a href="${waLink}" class="contact-btn" target="_blank">
                            <i class="fab fa-whatsapp"></i> ${t.btn_contact}
                        </a>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function getCoverImage(subject) {
            const sub = (subject || "").toLowerCase();
            if(sub.includes('math')) return 'https://images.unsplash.com/photo-1635070041078-e363dbe005cb?q=80&w=400';
            if(sub.includes('fran') || sub.includes('mala')) return 'https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?q=80&w=400';
            if(sub.includes('phys')) return 'https://images.unsplash.com/photo-1636466497217-26a8cbeaf0aa?q=80&w=400';
            return 'https://images.unsplash.com/photo-1503676260728-1c00da094a0b?q=80&w=400';
        }

        /* =========================================
           5. GESTION THÃˆME
           ========================================= */
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('themeIcon').className = savedTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
        }

        function toggleTheme() {
            const html = document.documentElement;
            const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            document.getElementById('themeIcon').className = next === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
        }

        init();
    </script>
</body>
</html>